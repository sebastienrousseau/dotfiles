#!/usr/bin/env bash

# run_onchange_install_packages.sh.tmpl
# This script runs whenever its content changes (e.g., when you update the list of packages).

{{- if eq .chezmoi.os "darwin" }}
# macOS: Use Homebrew
echo "ï£¿ macOS detected. Checking Homebrew packages..."

if ! command -v brew >/dev/null; then
  echo "Homebrew not found. Installing..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Brewfile hash: {{ include "dot_config/dotfiles/Brewfile" | sha256sum }}
if [ -f "$HOME/.config/dotfiles/Brewfile" ]; then
  echo "Installing packages from Brewfile..."
  brew bundle --file="$HOME/.config/dotfiles/Brewfile"
fi

{{- else if eq .chezmoi.os "linux" }}
# Linux: Use apt-get (assuming Debian/Ubuntu for now)
echo "ðŸ§ Linux detected. Updating packages..."

if command -v apt-get >/dev/null; then
  sudo apt-get update
  # Add your packages here
  # packages=(
  #   curl
  #   git
  #   zsh
  # )
  # sudo apt-get install -y "${packages[@]}"
fi

{{- else if eq .chezmoi.os "windows" }}
# Windows: Use winget
echo "ðŸªŸ Windows detected. Checking winget..."
# winget import ...
{{- end }}
