{{- $git_name := "" -}}
{{- $git_email := "" -}}
{{- $git_signingkey := "" -}}
{{- $git_signingformat := "ssh" -}}
{{- $name := "" -}}
{{- $email := "" -}}
{{- $signingkey := "" -}}
{{- if hasKey . "git_name" }}{{- $git_name = index . "git_name" -}}{{- end -}}
{{- if hasKey . "git_email" }}{{- $git_email = index . "git_email" -}}{{- end -}}
{{- if hasKey . "git_signingkey" }}{{- $git_signingkey = index . "git_signingkey" -}}{{- end -}}
{{- if hasKey . "git_signingformat" }}{{- $git_signingformat = index . "git_signingformat" -}}{{- end -}}
{{- if hasKey . "name" }}{{- $name = index . "name" -}}{{- end -}}
{{- if hasKey . "email" }}{{- $email = index . "email" -}}{{- end -}}
{{- if hasKey . "signingkey" }}{{- $signingkey = index . "signingkey" -}}{{- end -}}

{{- if and (not $git_name) $name }}{{- $git_name = $name -}}{{- end -}}
{{- if and (not $git_email) $email }}{{- $git_email = $email -}}{{- end -}}
{{- if and (not $git_signingkey) $signingkey }}{{- $git_signingkey = $signingkey -}}{{- end -}}

[user]
{{- if $git_name }}
	name = {{ $git_name }}
{{- end }}
{{- if $git_email }}
	email = {{ $git_email }}
{{- end }}
{{- if $git_signingkey }}
	signingkey = {{ $git_signingkey }}
{{- end }}

{{- if $git_signingkey }}
[commit]
	gpgsign = true

[gpg]
	format = {{ $git_signingformat }}

[gpg "ssh"]
	allowedSignersFile = {{ .chezmoi.homeDir }}/.ssh/allowed_signers
{{- end }}

[core]
	excludesfile = {{ .chezmoi.homeDir }}/.config/git/ignore
	attributesFile = {{ .chezmoi.homeDir }}/.config/git/attributes

[fetch]
	prune = true

[push]
	autoSetupRemote = true

[pull]
	rebase = true

[rerere]
	enabled = true

[maintenance]
	auto = true
	strategy = incremental

[worktree]
	guessRemote = true

[delta]
	features = decorations
	syntax-theme = TwoDark

[diff]
	colorMoved = default

[filter "lfs"]
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true

# Credential helpers - platform specific
{{- if eq .chezmoi.os "darwin" }}
[credential]
	helper = osxkeychain
{{- else if eq .chezmoi.os "linux" }}
[credential]
	helper = cache --timeout=3600
	helper = /usr/share/doc/git/contrib/credential/libsecret/git-credential-libsecret
{{- end }}

# GitHub specific credential helper
[credential "https://github.com"]
	helper = !gh auth git-credential

# GitLab specific credential helper
[credential "https://gitlab.com"]
	helper = !glab auth git-credential
