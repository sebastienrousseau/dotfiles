#!/usr/bin/env bash

# run_onchange_darwin_install-packages.sh.tmpl
{{- if eq .chezmoi.os "darwin" -}}

# Strict error handling
set -euo pipefail

log_info() { echo -e "\n[INFO] $*"; }
log_error() { echo -e "\n[ERROR] $*" >&2; }

log_info " macOS: Starting setup..."

# Check Homebrew
if ! command -v brew >/dev/null; then
  log_info "Homebrew not found. Installing..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Brewfile hash: {{ include "dot_config/shell/Brewfile" | sha256sum }}
if [ -f "$HOME/.config/shell/Brewfile" ]; then
  log_info "Installing packages from Brewfile..."
  brew bundle --file="$HOME/.config/shell/Brewfile"
fi

log_info " macOS: Setup complete."
{{- end -}}
