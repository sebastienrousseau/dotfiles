#!/bin/sh
# Interactive Tour using Gum
# Part of Dotfiles v0.2.474

if ! command -v gum >/dev/null; then
    echo "Error: 'gum' is not installed."
    case "$(uname -s)" in
        Darwin)
            echo "Install: brew install gum"
            ;;
        Linux)
            if command -v snap >/dev/null; then
                echo "Install: sudo snap install gum --classic"
            else
                echo "Install: go install github.com/charmbracelet/gum@latest"
            fi
            ;;
        *)
            echo "Install gum from: https://github.com/charmbracelet/gum"
            ;;
    esac
    exit 1
fi

clear

# Intro (match UI header style)
banner='██████╗  ██████╗ ████████╗███████╗██╗██╗     ███████╗███████╗
██╔══██╗██╔═══██╗╚══██╔══╝██╔════╝██║██║     ██╔════╝██╔════╝
██║  ██║██║   ██║   ██║   █████╗  ██║██║     █████╗  ███████╗
██║  ██║██║   ██║   ██║   ██╔══╝  ██║██║     ██╔══╝  ╚════██║
██████╔╝╚██████╔╝   ██║   ██║     ██║███████╗███████╗███████║
╚═════╝  ╚═════╝    ╚═╝   ╚═╝     ╚═╝╚══════╝╚══════╝╚══════╝

v0.2.474 · Infrastructure‑grade shell environment'

gum style \
    --foreground 212 --border-foreground 212 --border double \
    --align center --margin "1 2" --padding "1 2" \
    "$banner"

echo ""
gum confirm "Start a quick tour?" || exit 0
clear

# Slide 1: Start here
gum style \
    --foreground 99 --border rounded --padding "1 2" --margin "1 2" \
    "Start here" \
    "Apply your setup. Keep it repeatable." \
    " " \
    "dot apply   # Apply your dotfiles" \
    "dot update  # Pull and apply updates" \
    "dot diff    # Review local changes" \
    "dot drift   # Snapshot config drift"

echo ""
gum confirm "Next: Check health" || exit 0
clear

# Slide 2: Diagnostics
gum style \
    --foreground 75 --border rounded --padding "1 2" --margin "1 2" \
    "Check health" \
    "Know what’s working. See what needs attention." \
    " " \
    "dot doctor    # Health checks" \
    "dot history   # History analysis" \
    "dot benchmark # Startup timing"

echo ""
gum confirm "Next: Secrets" || exit 0
clear

# Slide 3: Secrets
gum style \
    --foreground 214 --border rounded --padding "1 2" --margin "1 2" \
    "Secrets (age)" \
    "Keep sensitive data local and encrypted." \
    " " \
    "dot secrets-init   # Create a key" \
    "dot secrets        # Edit secrets" \
    "dot secrets-create # New encrypted file" \
    "dot ssh-key        # Encrypt an SSH key"

echo ""
gum confirm "Next: Security (opt‑in)" || exit 0
clear

# Slide 4: Security (opt-in)
gum style \
    --foreground 150 --border double --padding "1 2" --margin "1 2" \
    "Security (opt‑in)" \
    "Explicit by design. Nothing changes without your choice." \
    " " \
    "dot firewall      # Firewall hardening" \
    "dot telemetry     # Disable OS telemetry" \
    "dot dns-doh       # DNS‑over‑HTTPS (Linux)" \
    "dot lock-screen   # Idle lock settings" \
    "dot usb-safety    # Disable automount" \
    "dot encrypt-check # Disk encryption status"

echo ""
gum confirm "Next: Themes & UX" || exit 0
clear

# Slide 5: Themes & UX
gum style \
    --foreground 212 --border rounded --padding "1 2" --margin "1 2" \
    "Themes & UX" \
    "Make it yours without changing how it works." \
    " " \
    "dot theme      # Switch theme" \
    "dot wallpaper  # Apply wallpaper" \
    "dot fonts      # Install Nerd Fonts" \
    "dot keys       # Keybindings" \
    "dot tools      # Curated utilities"

echo ""
gum confirm "Next: Projects & Sandbox" || exit 0
clear

# Slide 6: Projects & Sandbox
gum style \
    --foreground 111 --border rounded --padding "1 2" --margin "1 2" \
    "Projects & sandbox" \
    "Start quickly. Experiment safely." \
    " " \
    "dot new <lang> <name>  # Templates: python, go, node" \
    "dot sandbox            # Safe preview (Docker/Podman)" \
    "dot edit               # Open source in editor"

echo ""
gum style \
    --foreground 212 --margin "1 2" \
    "You’re all set. Tip: run 'dot update' weekly to stay current."
echo ""
