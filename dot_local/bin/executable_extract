#!/usr/bin/env bash
set -euo pipefail

# --- UI Theme ---
PURPLE='\033[38;5;141m'
GRAY='\033[38;5;244m'
NC='\033[0m'
BOLD='\033[1m'

[[ $# -lt 1 ]] && exit 1
FILE="$1"
DEST="${2:-.}"

if [[ ! -f "$FILE" ]]; then
  echo "Error: File not found: $FILE"
  exit 1
fi

mkdir -p "$DEST"

echo -e "${PURPLE}󰛒 Extracting${NC} ${BOLD}$FILE${NC} ${GRAY}➜${NC} ${BOLD}$DEST${NC}"

extract_tar_zst() {
  if tar --help 2>/dev/null | grep -q -- '--zstd'; then
    tar --zstd -xf "$FILE" -C "$DEST"
  else
    zstd -dc "$FILE" | tar -xf - -C "$DEST"
  fi
}

case "$FILE" in
  *.tar.zst|*.tzst) extract_tar_zst ;;
  *.tar.gz|*.tgz)   tar xzf "$FILE" -C "$DEST" ;;
  *.tar.bz2|*.tbz2) tar xjf "$FILE" -C "$DEST" ;;
  *.tar.xz|*.txz)   tar xJf "$FILE" -C "$DEST" ;;
  *.tar)            tar xf "$FILE" -C "$DEST" ;;
  *.zip|*.jar)      unzip -q "$FILE" -d "$DEST" ;;
  *.7z)             7z x "$FILE" -o"$DEST" >/dev/null ;;
  *.rar)            unrar x "$FILE" "$DEST/" || 7z x "$FILE" -o"$DEST" ;;
  *)                echo "Unsupported format" && exit 1 ;;
esac
