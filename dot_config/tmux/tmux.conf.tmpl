{{- $theme := default "catppuccin-mocha" .theme -}}
{{- $status_bg := "#2D1681" -}}
{{- $status_fg := "#FFFFFF" -}}
{{- $accent_blue := "#007ACC" -}}
{{- $accent_red := "#EB0000" -}}
{{- $panel_bg := "#14222A" -}}
{{- if eq $theme "catppuccin-mocha" -}}
{{- $status_bg = "#1e1e2e" -}}
{{- $status_fg = "#cdd6f4" -}}
{{- $accent_blue = "#89b4fa" -}}
{{- $accent_red = "#f38ba8" -}}
{{- $panel_bg = "#181825" -}}
{{- else if eq $theme "catppuccin-latte" -}}
{{- $status_bg = "#eff1f5" -}}
{{- $status_fg = "#4c4f69" -}}
{{- $accent_blue = "#1e66f5" -}}
{{- $accent_red = "#d20f39" -}}
{{- $panel_bg = "#e6e9ef" -}}
{{- end }}

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  TMUX CONFIGURATION (Universal)                                          â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# --- GENERAL SETTINGS ---
set -g default-terminal "xterm-256color"
if-shell 'uname | grep -q Linux' 'set -g default-terminal "tmux-256color"'
set-option -sa terminal-overrides ",*256col*:Tc"

unbind C-b
set -g prefix C-a
bind C-a send-prefix

set -g mouse on
set -g history-limit 102400
set -g set-clipboard on
set -g escape-time 10
set -g focus-events on
set -g repeat-time 600
setw -g xterm-keys on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g aggressive-resize on
set -g monitor-activity on
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g allow-rename off
setw -g automatic-rename off
setw -g mode-keys vi

# --- KEY BINDINGS & NAVIGATION ---

# Reload Config
bind r source-file ~/.tmux.conf \; display ".tmux.conf reloaded"

# Window Management
bind -r C-h previous-window
bind -r C-l next-window
bind a last-window
bind Tab last-window
bind N new-window
bind n command-prompt -p "New window name:" "new-window -n '%%'"
bind R command-prompt -p "Rename window:" "rename-window '%%'"
bind X confirm-before -p "kill-window #W? (y/n)" kill-window

# Splits (Current Path)
bind % split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind '\' split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v
bind _ split-window -h

# Pane Navigation (Vim-style)
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R
bind -r z resize-pane -Z

# Pane Resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Pane Movement
bind < swap-pane -U
bind > swap-pane -D
bind q kill-pane

# Session Management
bind C-c new-session
bind C-f command-prompt -p find-session 'switch-client -t %%'
bind K confirm-before -p "kill all sessions? (y/n)" kill-server

# --- THEME & STATUS BAR ---

set -g status-bg "{{ $status_bg }}"
set -g status-fg "{{ $status_fg }}"
set -g status-interval 5
set -g status-justify centre
set -g status-left-length 50
set -g status-right-length 50

# OS-Specific Status Left
if-shell 'uname | grep -q Darwin' 'set -g status-left "#[bg={{ $accent_blue }}] ğŸ macOS #S #[bg={{ $accent_red }}] #W #[bg={{ $panel_bg }}]"'
if-shell 'uname | grep -q Linux' 'set -g status-left "#[bg={{ $accent_blue }}] ğŸ§ Linux #S #[bg={{ $accent_red }}] #W #[bg={{ $panel_bg }}]"'
if-shell 'uname | grep -q MINGW' 'set -g status-left "#[bg={{ $accent_blue }}] ğŸªŸ Windows #S #[bg={{ $accent_red }}] #W #[bg={{ $panel_bg }}]"'

set -g status-right "#[fg={{ $status_fg }}] #[bg={{ $panel_bg }}] â¬› #I #[bg={{ $accent_blue }}] #H #[bg={{ $accent_red }}] %_d %B %I:%M%p "
set -g window-status-current-format "#[bg={{ $status_bg }}]Dotfiles (v0.2.473)"
set -g window-status-current-style "bg={{ $accent_red }}"
set -g window-status-separator ""
set-window-option -g clock-mode-colour "{{ $status_fg }}"
set-window-option -g clock-mode-style 24

# --- LINUX SPECIFIC ---
if-shell 'uname | grep -q Linux' {
  bind -n WheelDownPane select-pane -t= \; send-keys -M
  bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
  bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -selection c"
  bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
}

# --- PLUGINS (TPM) ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'
