#!/usr/bin/env bash

# Universal Paths (Generated by Chezmoi)
# Note: XDG variables are set in ~/.zshenv (Bootloader)

# 1. System Paths (Prepend, but will be pushed down by later prepends)
export PATH="/usr/bin:/bin:/usr/sbin:/sbin:${PATH}"

# 2. Homebrew Paths (Prepend -> Higher Priority)
if [[ -d "/opt/homebrew/bin" ]]; then
    export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:${PATH}"
fi

# 3. Language Runtimes
# Ruby (Homebrew)
if [[ -d "/opt/homebrew/opt/ruby/bin" ]]; then
    export PATH="/opt/homebrew/opt/ruby/bin:${PATH}"
fi
# Ruby (User Gems)
export PATH="${HOME}/.gem/ruby/bin:${PATH}"

# Python (Pipx)
export PIPX_HOME="${XDG_DATA_HOME:-$HOME/.local/share}/pipx"
export PIPX_BIN_DIR="${XDG_BIN_HOME:-$HOME/.local/bin}"
export PATH="${PIPX_BIN_DIR}:${PATH}"

# Rust (Cargo)
export PATH="${HOME}/.cargo/bin:${PATH}"

# Go
export PATH="${HOME}/go/bin:${PATH}"

# Node.js (Global)
export PATH="${HOME}/.node_modules/bin:${PATH}"

# Lua (Luarocks)
export PATH="${HOME}/.luarocks/bin:${PATH}"

# 4. Applications (macOS Specifics)
if [[ "$(uname -s 2>/dev/null)" == "Darwin" ]]; then
    export PATH="/Library/Apple/usr/bin:/Library/TeX/texbin:${PATH}"
    if [[ -d "/Applications/Topaz Photo AI.app/Contents/Resources/bin" ]]; then
        export PATH="/Applications/Topaz Photo AI.app/Contents/Resources/bin:${PATH}"
    fi
    if [[ -d "/Applications/Little Snitch.app/Contents/Components" ]]; then
        export PATH="/Applications/Little Snitch.app/Contents/Components:${PATH}"
    fi
    if [[ -d "/Applications/iTerm.app/Contents/Resources/utilities" ]]; then
        export PATH="/Applications/iTerm.app/Contents/Resources/utilities:${PATH}"
    fi
    if [[ -d "/Applications/Visual Studio Code.app/Contents/Resources/app/bin" ]]; then
        export PATH="/Applications/Visual Studio Code.app/Contents/Resources/app/bin:${PATH}"
    fi
fi

# 5. Local Bin (Highest Priority)
export PATH="${HOME}/.local/bin:${PATH}"

# Deduplicate PATH (Keep first occurrence to maintain precedence)
# Standard Zsh handles this with 'typeset -U path', but for bash compatibility/subshells:
if [ -z "$ZSH_VERSION" ]; then
    PATH=$(echo "$PATH" | awk -v RS=':' '!seen[$0]++ {ORS=(NR>1?":":"")} {print}')
    export PATH
fi
