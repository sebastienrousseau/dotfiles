#!/usr/bin/env bash

# Core Aliases â€” Eager Load (Generated by Chezmoi)
# These are lightweight, high-frequency aliases loaded at shell startup.
if [ -n "${BASH_VERSION:-}" ]; then
  shopt -s expand_aliases
fi
if [ -n "${ZSH_VERSION:-}" ]; then
  setopt aliases
fi

{{ $coreCategories := list "archives" "cd" "clear" "configuration" "default" "diagnostics" "disk-usage" "docker" "editor" "git" "interactive" "installer" "mkdir" "modern" "ps" "rsync" "sudo" "system" "compliance" -}}
{{ $aliasProfile := lower (default "standard" (env "DOTFILES_ALIAS_PROFILE")) -}}
{{ $aliasBuckets := default (dict) .aliases.buckets -}}
{{ $globPattern := joinPath .chezmoi.sourceDir ".chezmoitemplates/aliases/**/*.aliases.sh" -}}
{{ $files := glob $globPattern -}}
{{ range $files -}}
  {{ $name := . -}}
  {{ $isCore := false -}}
  {{ $bucketEnabled := true -}}
  {{ if contains "/system/" $name -}}
    {{ $bucketEnabled = default true (index $aliasBuckets "system") -}}
  {{ end -}}
  {{ if contains "/subversion/" $name -}}
    {{ $bucketEnabled = default true (index $aliasBuckets "svn") -}}
  {{ end -}}
  {{ $isCoreMinimalExcluded := or (contains "/interactive/" $name) (contains "/sudo/" $name) -}}
  {{ $includeByProfile := true -}}
  {{ if and (eq $aliasProfile "minimal") $isCoreMinimalExcluded -}}
    {{ $includeByProfile = false -}}
  {{ end -}}
  {{ range $coreCategories -}}
    {{ if contains (printf "/%s/" .) $name -}}
      {{ $isCore = true -}}
    {{ end -}}
  {{ end -}}
  {{ if and $isCore (not (contains "/macOS/" $name)) (not (contains "/archives/" $name)) $includeByProfile $bucketEnabled }}
{{ include $name }}
  {{ end -}}
{{ end }}

# Archive aliases loaded last among core aliases so extraction shortcuts
# take precedence over earlier generic shims.
{{- range $files -}}
  {{- $name := . -}}
  {{- if and (contains "/archives/" $name) (not (contains "/macOS/" $name)) }}
{{ include $name }}
  {{- end -}}
{{- end }}

# Zsh fallback: if alias expansion is disabled, provide function shims.
if [ -n "${ZSH_VERSION:-}" ]; then
  if ! setopt | grep -q '^aliases$'; then
    c() { clear_screen; }
    q() { exit; }
    e() { "${EDITOR:-nano}" "$@"; }
    h() { history; }
    l() { dot_ls "$@"; }
    ll() { dot_ll "$@"; }
    la() { dot_la "$@"; }
    lt() { dot_lt "$@"; }
    lr() { dot_lr "$@"; }
    lra() { dot_lra "$@"; }
    lta() { dot_lta "$@"; }
    d() { command -v dot >/dev/null 2>&1 && dot "$@" || command -v docker >/dev/null 2>&1 && docker "$@"; }
    i() { command -v epoch >/dev/null 2>&1 && epoch "$@"; }
    a() { command -v ai_core >/dev/null 2>&1 && ai_core query "$@"; }
    _() { sudo "$@"; }
  fi
fi

# OS-Specific Core Aliases

## macOS
{{- if eq .chezmoi.os "darwin" }}
  {{- $macGlobPattern := joinPath .chezmoi.sourceDir ".chezmoitemplates/aliases/macOS/*.aliases.sh" }}
  {{- $macFiles := glob $macGlobPattern }}
  {{- range $macFiles }}
    {{- include . }}
    {{- "\n" }}
  {{- end }}
{{- end }}
